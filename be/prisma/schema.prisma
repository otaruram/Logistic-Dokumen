// Prisma schema untuk Supply Chain OCR Multi-User System

generator client {
  provider             = "prisma-client-py"
  recursive_type_depth = 5
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Logs {
  id           Int      @id @default(autoincrement())
  userId       String   @default("anonymous@system.local") @map("user_id")
  timestamp    DateTime @default(now())
  filename     String
  kategori     String
  nomorDokumen String   @map("nomor_dokumen")
  receiver     String
  imagePath    String   @map("image_path")
  summary      String   @db.Text
  fullText     String   @map("full_text") @db.Text

  @@index([userId])
  @@map("logs")
}

model ApiKey {
  id        Int      @id @default(autoincrement())
  userId    String   @map("user_id")
  apiKey    String   @map("api_key")
  provider  String   @default("openai")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, provider])
  @@index([userId])
  @@map("api_keys")
}

model User {
  id              Int               @id @default(autoincrement())
  email           String            @unique
  name            String?
  creditBalance   Int               @default(3) @map("credit_balance")
  tier            String            @default("starter")
  lastCreditReset DateTime?         @map("last_credit_reset")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  
  // Relations
  transactions    CreditTransaction[]
  
  @@map("users")
}

model CreditTransaction {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  amount      Int      
  description String
  createdAt   DateTime @default(now()) @map("created_at")
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@map("credit_transactions")
}

// ðŸ”¥ MODEL BARU: RATING ðŸ”¥
model Rating {
  id         Int      @id @default(autoincrement())
  userId     String   @map("user_id") // Kita pakai email sebagai ID string
  userName   String   @map("user_name")
  userAvatar String   @map("user_avatar")
  stars      Int
  emoji      String
  message    String   @db.Text
  createdAt  DateTime @default(now()) @map("created_at")

  @@map("ratings")
}
